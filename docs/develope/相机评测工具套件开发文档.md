# 相机评测工具套件 - 开发计划书

## 1. 项目概述

### 1.1 项目背景

当前视频评测流程中，相机镜头的评测工作涉及多个专业维度的数据采集与分析。本工具套件旨在为相机评测提供一站式的专业测试解决方案，涵盖从基础参数测试到高级图像质量分析的完整工作流程。

### 1.2 项目目标

- 构建模块化的相机评测工具集合
- 提供直观的可视化分析界面
- 支持多种相机型号的标准化测试
- 生成可导出的专业评测报告

### 1.3 核心功能模块

1. **MTF曲线测试工具** - 锐度与解析力分析
2. **色彩准确度测试** - 色彩还原与偏色检测
3. **动态范围测试** - 宽容度与细节保留能力
4. **噪点分析工具** - 高ISO性能评估
5. **畸变测试工具** - 桶形/枕形畸变测量
6. **暗角测试工具** - 边缘亮度衰减分析
7. **白平衡测试** - 色温准确性验证
8. **对焦性能测试** - 自动对焦速度与精度
9. **视频规格测试** - 视频模式专项评测

## 2. 技术架构

### 2.1 技术栈选择

| 层级     | 技术选型                 | 说明           |
| -------- | ------------------------ | -------------- |
| 前端框架 | React 18 + TypeScript    | 组件化开发     |
| UI组件库 | shadcn/ui + Tailwind CSS | 现代化设计系统 |
| 图表库   | Recharts + D3.js         | 专业数据可视化 |
| 图像处理 | Canvas API + WebGL       | 高性能图像分析 |
| 状态管理 | Zustand                  | 轻量级状态管理 |
| 文件处理 | Browser File API         | 本地图像读取   |

### 2.2 项目结构

```
src/
├── components/
│   ├── ui/                    # shadcn/ui 基础组件
│   ├── camera-tools/          # 相机评测工具组件
│   │   ├── MTFAnalyzer/       # MTF曲线分析
│   │   ├── ColorChecker/      # 色彩准确度
│   │   ├── DynamicRange/      # 动态范围
│   │   ├── NoiseAnalyzer/     # 噪点分析
│   │   ├── DistortionTest/    # 畸变测试
│   │   ├── VignettingTest/    # 暗角测试
│   │   ├── WhiteBalance/      # 白平衡测试
│   │   ├── AutoFocusTest/     # 对焦性能
│   │   └── VideoSpecs/        # 视频规格
│   └── shared/                # 共享组件
├── lib/
│   ├── image-processing/      # 图像处理算法
│   ├── calculations/          # 数学计算模块
│   └── export/                # 报告导出
├── stores/                    # Zustand 状态管理
├── types/                     # TypeScript 类型定义
└── utils/                     # 工具函数
```

## 3. 功能模块详细设计

### 3.1 MTF曲线测试工具

#### 功能描述

MTF (Modulation Transfer Function) 是衡量镜头解析力的核心指标，通过分析斜边测试图获取镜头在不同空间频率下的对比度传递能力。

#### 核心功能

- **斜边检测**：自动识别测试图中的黑白边界
- **ESF计算**：提取边缘扩散函数
- **LSF导出**：通过微分获取线扩散函数
- **MTF曲线**：傅里叶变换生成MTF曲线
- **多点测量**：支持中心、边缘、角落多点测试

#### 数据输出

| 指标     | 说明                      | 单位  |
| -------- | ------------------------- | ----- |
| MTF50    | 对比度降至50%时的空间频率 | lp/mm |
| MTF30    | 对比度降至30%时的空间频率 | lp/mm |
| 中心锐度 | 画面中心的MTF值           | %     |
| 边缘锐度 | 画面边缘的MTF值           | %     |

#### 界面设计

- 图像上传区域（支持拖拽）
- ROI选择工具（矩形选区）
- 实时MTF曲线图表
- 多镜头对比视图
- 数据导出按钮

### 3.2 色彩准确度测试

#### 功能描述

使用标准色卡（ColorChecker 24色卡）评估相机的色彩还原能力，计算实际拍摄色彩与标准值的偏差。

#### 核心功能

- **色卡识别**：自动检测24色块位置
- **Lab转换**：RGB到CIE Lab色彩空间转换
- **ΔE计算**：计算每个色块的色差值
- **色彩映射**：生成色彩偏移向量图
- **白平衡校正**：基于灰色块的白平衡分析

#### 数据输出

| 指标       | 说明               | 评价标准        |
| ---------- | ------------------ | --------------- |
| 平均ΔE     | 所有色块的平均色差 | <3优秀，<5良好  |
| 最大ΔE     | 单个色块最大色差   | <5优秀，<10良好 |
| 饱和度偏差 | 整体饱和度倾向     | 百分比          |
| 色相偏移   | 主要色相的偏移方向 | 度数            |

### 3.3 动态范围测试

#### 功能描述

测量相机从最亮到最暗能够记录的光线范围，评估高光保留和暗部细节能力。

#### 核心功能

- **灰阶分析**：检测阶梯灰阶图的各级亮度
- **信噪比计算**：确定可用动态范围边界
- **高光恢复**：评估过曝区域的恢复能力
- **暗部提升**：测试暗部提亮后的噪点表现
- **RAW vs JPG**：对比不同格式的动态范围

#### 数据输出

| 指标            | 说明                | 单位  |
| --------------- | ------------------- | ----- |
| 总动态范围      | 可用亮度级数        | EV/档 |
| 高光余量        | 过曝前的安全空间    | EV    |
| 暗部范围        | 可恢复的暗部级数    | EV    |
| 基准ISO动态范围 | 最低ISO下的动态范围 | EV    |

### 3.4 噪点分析工具

#### 功能描述

评估不同ISO设置下的图像噪点水平，包括亮度噪点和色彩噪点的分离分析。

#### 核心功能

- **均匀区域检测**：自动识别适合噪点分析的区域
- **噪点分离**：分离亮度噪点与色度噪点
- **频谱分析**：噪点的空间频率分布
- **ISO阶梯测试**：自动化多ISO对比
- **降噪评估**：机内降噪效果评测

#### 数据输出

| 指标        | 说明              | 单位  |
| ----------- | ----------------- | ----- |
| 亮度噪点    | Y通道标准差       | σ     |
| 色度噪点    | Cb/Cr通道标准差   | σ     |
| 信噪比(SNR) | 信号与噪声比值    | dB    |
| 可用ISO上限 | SNR>30dB的最高ISO | ISO值 |

### 3.5 畸变测试工具

#### 功能描述

测量镜头的几何畸变，包括桶形畸变、枕形畸变和复杂畸变。

#### 核心功能

- **网格检测**：识别标准网格图的交点
- **畸变计算**：计算各点的径向位移
- **畸变类型**：判定畸变类型（桶形/枕形/复杂）
- **畸变曲线**：绘制畸变随半径变化曲线
- **校正预览**：预览畸变校正效果

#### 数据输出

| 指标       | 说明                  | 单位 |
| ---------- | --------------------- | ---- |
| 最大畸变   | 边缘最大畸变量        | %    |
| 畸变类型   | 桶形/枕形/胡子形      | -    |
| k1, k2系数 | Brown-Conrady畸变系数 | -    |
| 校正残差   | 校正后剩余畸变        | %    |

### 3.6 暗角测试工具

#### 功能描述

测量镜头边缘相对于中心的光量衰减程度。

#### 核心功能

- **均匀光源拍摄分析**：基于灰卡/均匀墙面图像
- **径向亮度分析**：计算中心到边缘的亮度变化
- **光圈对比**：不同光圈下的暗角变化
- **热力图生成**：生成亮度分布热力图
- **校正系数**：输出暗角校正LUT

#### 数据输出

| 指标         | 说明                   | 单位 |
| ------------ | ---------------------- | ---- |
| 角落亮度衰减 | 四角相对中心的亮度损失 | EV/% |
| 边缘亮度衰减 | 四边中点的亮度损失     | EV/% |
| 均匀性评分   | 整体亮度均匀性         | 分数 |
| 最佳光圈     | 暗角最小的光圈值       | f值  |

### 3.7 白平衡测试

#### 功能描述

评估相机在不同光源下的自动白平衡准确性。

#### 核心功能

- **色温检测**：基于灰卡计算实际色温
- **偏色分析**：计算绿-品红轴偏移
- **多光源测试**：日光/钨丝灯/荧光灯/LED
- **预设评估**：各白平衡预设的准确度
- **手动校正指导**：提供校正建议值

#### 数据输出

| 指标        | 说明               | 单位  |
| ----------- | ------------------ | ----- |
| 色温偏差    | 与标准色温的差异   | K     |
| 绿-品红偏移 | Tint轴的偏移量     | Mired |
| AWB响应速度 | 光源变化后稳定时间 | 秒    |
| 预设准确度  | 各预设的ΔE值       | ΔE    |

### 3.8 对焦性能测试

#### 功能描述

评估自动对焦系统的速度、精度和追焦能力。

#### 核心功能

- **对焦速度测量**：从失焦到合焦的时间
- **对焦精度**：实际焦点与目标的偏差
- **低光对焦**：不同光线下的对焦能力
- **追焦测试**：移动目标的追踪成功率
- **眼部对焦**：人眼检测与对焦评估

#### 数据输出

| 指标         | 说明             | 单位   |
| ------------ | ---------------- | ------ |
| 单次对焦时间 | 从触发到合焦     | ms     |
| 对焦命中率   | 成功对焦的比例   | %      |
| 低光极限     | 可对焦的最低照度 | EV/Lux |
| 追焦成功率   | 连续对焦的命中率 | %      |

### 3.9 视频规格测试

#### 功能描述

专门针对视频模式的各项参数测试。

#### 核心功能

- **分辨率验证**：实际分辨率与标称对比
- **帧率稳定性**：实际帧率波动分析
- **果冻效应**：滚动快门程度测量
- **裁切系数**：视频模式的画幅裁切
- **码率分析**：实际码率与质量关系
- **热停机测试**：连续录制的温度限制

#### 数据输出

| 指标         | 说明             | 单位   |
| ------------ | ---------------- | ------ |
| 实际分辨率   | 有效解析线数     | 线/TVL |
| 帧率稳定性   | 帧间隔标准差     | ms     |
| 滚动快门     | 读出时间         | ms     |
| 裁切系数     | 相对全幅的裁切   | x倍    |
| 最大录制时长 | 热停机前录制时间 | 分钟   |

## 4. 共享组件设计

### 4.1 图像上传组件

```typescript
interface ImageUploaderProps {
  accept?: string[] // 支持的文件格式
  multiple?: boolean // 是否支持多文件
  maxSize?: number // 最大文件大小(MB)
  onUpload: (files: File[]) => void
  onError?: (error: string) => void
}
```

**功能特性**：

- 拖拽上传支持
- 文件类型验证
- 文件大小限制
- 上传进度显示
- 图片预览功能

### 4.2 图像查看器组件

```typescript
interface ImageViewerProps {
  src: string // 图像源
  zoom?: boolean // 启用缩放
  pan?: boolean // 启用平移
  overlay?: ReactNode // 叠加层(ROI显示等)
  onRegionSelect?: (region: Region) => void
}
```

**功能特性**：

- 鼠标滚轮缩放
- 拖拽平移
- ROI矩形选择
- 像素级查看
- EXIF信息显示

### 4.3 图表组件

```typescript
interface ChartProps {
  type: 'line' | 'bar' | 'scatter' | 'heatmap'
  data: DataPoint[]
  xAxis: AxisConfig
  yAxis: AxisConfig
  legend?: boolean
  exportable?: boolean
}
```

**功能特性**：

- 多种图表类型
- 交互式缩放
- 数据点悬停提示
- 图表导出(PNG/SVG)
- 多数据系列对比

### 4.4 数据表格组件

```typescript
interface DataTableProps {
  columns: ColumnDef[]
  data: any[]
  sortable?: boolean
  filterable?: boolean
  exportable?: boolean
}
```

**功能特性**：

- 列排序
- 数据筛选
- 分页显示
- CSV/Excel导出
- 自定义单元格渲染

## 5. 图像处理算法库

### 5.1 核心算法模块

| 模块                 | 功能                         | 依赖          |
| -------------------- | ---------------------------- | ------------- |
| `colorSpace.ts`      | 色彩空间转换(RGB/Lab/XYZ)    | -             |
| `fft.ts`             | 快速傅里叶变换               | -             |
| `edgeDetection.ts`   | 边缘检测算法                 | -             |
| `statistics.ts`      | 统计计算(均值/标准差/直方图) | -             |
| `interpolation.ts`   | 图像插值算法                 | -             |
| `noiseEstimation.ts` | 噪点估计算法                 | statistics.ts |

### 5.2 色彩空间转换

```typescript
// RGB to Lab
function rgbToLab(r: number, g: number, b: number): [number, number, number]

// Lab to RGB
function labToRgb(l: number, a: number, b: number): [number, number, number]

// 计算色差 ΔE2000
function deltaE2000(lab1: Lab, lab2: Lab): number

// 色温估算
function estimateColorTemperature(rgb: RGB): number
```

### 5.3 MTF计算流程

```typescript
// 1. 提取ROI区域
function extractROI(image: ImageData, region: Region): ImageData

// 2. 检测边缘角度
function detectEdgeAngle(roi: ImageData): number

// 3. 生成ESF (Edge Spread Function)
function computeESF(roi: ImageData, angle: number): number[]

// 4. 计算LSF (Line Spread Function)
function computeLSF(esf: number[]): number[]

// 5. FFT得到MTF曲线
function computeMTF(lsf: number[]): MTFCurve

// 6. 提取MTF50/MTF30值
function extractMTFValues(mtf: MTFCurve): MTFMetrics
```

## 6. 报告导出系统

### 6.1 报告模板

```typescript
interface ReportTemplate {
  title: string
  camera: CameraInfo
  testDate: Date
  tester: string
  sections: ReportSection[]
}

interface ReportSection {
  title: string
  type: 'text' | 'chart' | 'table' | 'image'
  content: any
}
```

### 6.2 导出格式

| 格式 | 用途     | 库                  |
| ---- | -------- | ------------------- |
| PDF  | 正式报告 | jsPDF + html2canvas |
| HTML | 网页预览 | 原生                |
| JSON | 数据交换 | 原生                |
| CSV  | 电子表格 | 原生                |

### 6.3 报告内容结构

1. **封面页**
   - 报告标题
   - 相机型号/镜头信息
   - 测试日期
   - 测试人员

2. **概要评分**
   - 雷达图展示各维度评分
   - 总体评价等级

3. **详细测试结果**
   - 各模块测试数据
   - 图表与分析
   - 与标准/竞品对比

4. **结论与建议**
   - 优势总结
   - 不足之处
   - 使用建议

## 7. 开发路线图

### 第一阶段：基础框架 (Week 1-2)

| 任务                               | 优先级 | 工时 |
| ---------------------------------- | ------ | ---- |
| 项目初始化 (React + TS + Tailwind) | P0     | 2h   |
| 基础UI组件搭建                     | P0     | 4h   |
| 图像上传组件                       | P0     | 4h   |
| 图像查看器组件                     | P0     | 6h   |
| 基础图表组件                       | P0     | 4h   |
| 路由与导航                         | P1     | 2h   |

### 第二阶段：核心算法 (Week 3-4)

| 任务           | 优先级 | 工时 |
| -------------- | ------ | ---- |
| 色彩空间转换库 | P0     | 4h   |
| FFT算法实现    | P0     | 6h   |
| 边缘检测算法   | P0     | 4h   |
| 统计计算模块   | P0     | 3h   |
| 噪点估计算法   | P1     | 4h   |

### 第三阶段：评测工具 (Week 5-8)

| 任务            | 优先级 | 工时 |
| --------------- | ------ | ---- |
| MTF曲线测试工具 | P0     | 12h  |
| 色彩准确度测试  | P0     | 10h  |
| 动态范围测试    | P0     | 8h   |
| 噪点分析工具    | P1     | 8h   |
| 畸变测试工具    | P1     | 6h   |
| 暗角测试工具    | P1     | 4h   |
| 白平衡测试      | P2     | 4h   |
| 对焦性能测试    | P2     | 6h   |
| 视频规格测试    | P2     | 6h   |

### 第四阶段：报告系统 (Week 9-10)

| 任务         | 优先级 | 工时 |
| ------------ | ------ | ---- |
| 报告模板设计 | P0     | 4h   |
| PDF导出功能  | P0     | 6h   |
| 对比报告生成 | P1     | 4h   |
| 历史数据管理 | P1     | 4h   |

## 8. 界面设计规范

### 8.1 布局结构

```
┌─────────────────────────────────────────────────────────┐
│  Logo    相机评测工具套件           [设置] [导出] [帮助] │
├─────────┬───────────────────────────────────────────────┤
│         │                                               │
│  导航   │              工作区域                         │
│         │                                               │
│ [MTF]   │  ┌─────────────────┐  ┌─────────────────┐    │
│ [色彩]  │  │                 │  │                 │    │
│ [动态]  │  │    图像预览     │  │    结果图表     │    │
│ [噪点]  │  │                 │  │                 │    │
│ [畸变]  │  └─────────────────┘  └─────────────────┘    │
│ [暗角]  │                                               │
│ [白平衡]│  ┌─────────────────────────────────────┐     │
│ [对焦]  │  │           数据表格 / 参数设置        │     │
│ [视频]  │  └─────────────────────────────────────┘     │
│         │                                               │
└─────────┴───────────────────────────────────────────────┘
```

### 8.2 配色方案

| 用途   | 颜色   | Hex值   |
| ------ | ------ | ------- |
| 主色调 | 深蓝色 | #1e40af |
| 强调色 | 橙色   | #f97316 |
| 成功   | 绿色   | #22c55e |
| 警告   | 黄色   | #eab308 |
| 错误   | 红色   | #ef4444 |
| 背景   | 浅灰   | #f8fafc |
| 文字   | 深灰   | #1e293b |

### 8.3 交互规范

- **加载状态**：所有耗时操作显示进度指示器
- **错误处理**：友好的错误提示，提供解决建议
- **快捷键**：常用操作支持键盘快捷键
- **响应式**：支持不同屏幕尺寸

## 9. 测试标准图

### 9.1 推荐测试图

| 测试项目 | 推荐测试图          | 用途           |
| -------- | ------------------- | -------------- |
| MTF/锐度 | ISO 12233           | 标准解析力测试 |
| 色彩     | X-Rite ColorChecker | 24色块标准色卡 |
| 动态范围 | Stouffer T4110      | 21级灰阶       |
| 畸变     | 方格网格图          | 几何畸变测量   |
| 暗角     | 均匀灰卡            | 亮度均匀性     |
| 白平衡   | 18%灰卡             | 色温校准       |

### 9.2 拍摄规范

- **光源**：D65标准光源或5500K色温灯
- **照度**：1000-2000 Lux均匀照明
- **距离**：根据镜头焦距调整，确保测试图填满画面
- **对焦**：使用三脚架，手动对焦至最佳锐度
- **曝光**：手动曝光，避免过曝或欠曝
- **格式**：优先使用RAW格式拍摄

## 10. 附录

### 10.1 参考标准

- ISO 12233:2017 - 摄影 - 电子静态图像相机 - 分辨率和空间频率响应的测量
- ISO 14524:2009 - 摄影 - 电子静态图像相机 - 光电转换函数测量方法
- ISO 17321:2012 - 图像技术 - 色彩特性化

### 10.2 技术参考

- [Imatest Documentation](https://www.imatest.com/docs/)
- [DxOMark Methodology](https://www.dxomark.com/)
- [Image Engineering Standards](https://www.image-engineering.de/)

### 10.3 版本历史

| 版本 | 日期    | 更新内容               |
| ---- | ------- | ---------------------- |
| v0.1 | 2024-12 | 初始版本，确定功能范围 |

---

_文档结束_
